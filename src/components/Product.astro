---
import { storyblokEditable } from '@storyblok/astro'

const { id, imageUrl, name, description, price, sizes } = Astro.props
const defaultSize = sizes[0] || 'M'; // Taglia di default, se disponibile
---

<div {...storyblokEditable({ id })} class={styles.product}>
  <img src={imageUrl} alt={`Image of ${name}`} class="h-48 w-48 object-cover" />
  <h3>{name}</h3>
  <p>{description}</p>
  <span>{`${price}â‚¬`}</span>
  
  <!-- Selezione della taglia -->
  <div class="size-selection">
    {sizes.map(size => (
      <button 
        key={size} 
        class={`size-button ${size === defaultSize ? 'selected' : ''}`} 
        data-size={size}
        onClick={() => document.querySelector('#add-to-cart').setAttribute('data-item-size', size)}
      >
        {size}
      </button>
    ))}
  </div>
  
  <!-- Pulsante Add to Cart -->
  <div>
    <button
      id="add-to-cart"
      class="snipcart-add-item"
      data-item-id={id}
      data-item-image={imageUrl}
      data-item-name={name}
      data-item-url={`/products/${id}`}
      data-item-price={price}
      data-item-size={defaultSize} 
    >
      Add to cart
    </button>
  </div>
</div>

<script>
document.querySelectorAll('.size-button').forEach(button => {
  button.addEventListener('click', (e) => {
    const size = e.currentTarget.getAttribute('data-size');
    document.querySelector('#add-to-cart').setAttribute('data-item-size', size);
    document.querySelectorAll('.size-button').forEach(btn => btn.classList.remove('selected'));
    e.currentTarget.classList.add('selected');
  });
});
</script>

<style>
.size-selection {
  margin: 10px 0;
}
.size-button {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 5px;
  cursor: pointer;
}
.size-button.selected {
  background-color: #50b0ae;
  color: white;
}
</style>
